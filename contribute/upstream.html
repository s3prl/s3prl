<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="nn" href="../_autosummary/s3prl.nn.html" /><link rel="prev" title="General Guideline" href="general.html" />

    <!-- Generated with Sphinx 5.1.1 and Furo 2023.03.27 -->
        <title>Adding New Upstream - S3PRL 0.4.18 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=fad236701ea90a88636c2a8c73b44ae642ed2a53" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">S3PRL 0.4.18
 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">S3PRL 0.4.18
 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/installation.html">Install S3PRL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/upstream_collection.html">S3PRL Upstream Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/problem.html">Use Problem module to run customizable recipes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How to Contribute</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="general.html">General Guideline</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Adding New Upstream</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/s3prl.nn.html">nn</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.beam_decoder.html">beam_decoder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.common.html">common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.hear.html">hear</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.interface.html">interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.linear.html">linear</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.pit.html">pit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.pooling.html">pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.rnn.html">rnn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.speaker_loss.html">speaker_loss</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.speaker_model.html">speaker_model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.specaug.html">specaug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.nn.upstream.html">upstream</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/s3prl.problem.html">problem</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.problem.asr.html">asr</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.asr.run.html">run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.asr.superb_asr.html">superb_asr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.asr.superb_pr.html">superb_pr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.asr.superb_sf.html">superb_sf</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.problem.asv.html">asv</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.asv.run.html">run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.asv.superb_asv.html">superb_asv</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.problem.base.html">base</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.problem.common.html">common</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.example.html">example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_beijing_opera.html">hear_beijing_opera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_cremad.html">hear_cremad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_dcase_2016_task2.html">hear_dcase_2016_task2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_esc50.html">hear_esc50</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_fsd.html">hear_fsd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_gsc5hr.html">hear_gsc5hr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_gtzan.html">hear_gtzan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_gtzan_music_speech.html">hear_gtzan_music_speech</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_gunshot.html">hear_gunshot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_libricount.html">hear_libricount</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_maestro.html">hear_maestro</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_nsynth5hr.html">hear_nsynth5hr</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_stroke.html">hear_stroke</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_tonic.html">hear_tonic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_vocal.html">hear_vocal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.hear_vox_lingual.html">hear_vox_lingual</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.run.html">run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.superb_er.html">superb_er</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.superb_ic.html">superb_ic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.superb_ks.html">superb_ks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.common.superb_sid.html">superb_sid</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.problem.diarization.html">diarization</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.diarization.run.html">run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.diarization.superb_sd.html">superb_sd</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.problem.diarization.util.html">util</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/s3prl.task.html">task</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.base.html">base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.diarization.html">diarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.dump_feature.html">dump_feature</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.event_prediction.html">event_prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.scene_prediction.html">scene_prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.speaker_verification_task.html">speaker_verification_task</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.speech2text_ctc_task.html">speech2text_ctc_task</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.task.utterance_classification_task.html">utterance_classification_task</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/s3prl.dataio.html">dataio</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.dataio.collate_fn.html">collate_fn</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.html">corpus</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.fluent_speech_commands.html">fluent_speech_commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.iemocap.html">iemocap</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.librilight.html">librilight</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.librispeech.html">librispeech</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.quesst14.html">quesst14</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.snips.html">snips</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.speech_commands.html">speech_commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.voxceleb1sid.html">voxceleb1sid</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.corpus.voxceleb1sv.html">voxceleb1sv</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.html">dataset</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.base.html">base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.diarization.html">diarization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.encode.html">encode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.frame_label.html">frame_label</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.load_audio.html">load_audio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.dataset.util.html">util</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.dataio.encoder.html">encoder</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.encoder.category.html">category</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.encoder.g2p.html">g2p</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.encoder.tokenizer.html">tokenizer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.encoder.vocabulary.html">vocabulary</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.html">sampler</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.balanced_weighted_sampler.html">balanced_weighted_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.distributed_sampler.html">distributed_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.fixed_batch_size_batch_sampler.html">fixed_batch_size_batch_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.group_same_item_sampler.html">group_same_item_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.max_timestamp_batch_sampler.html">max_timestamp_batch_sampler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/s3prl.dataio.sampler.sorted_sampler.html">sorted_sampler</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/s3prl.metric.html">metric</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.metric.common.html">common</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.metric.diarization.html">diarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.metric.slot_filling.html">slot_filling</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../_autosummary/s3prl.util.html">util</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.util.audio_info.html">audio_info</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.util.benchmark.html">benchmark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.util.download.html">download</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.util.override.html">override</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.util.pseudo_data.html">pseudo_data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/s3prl.util.seed.html">seed</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="adding-new-upstream">
<h1>Adding New Upstream<a class="headerlink" href="#adding-new-upstream" title="Permalink to this heading">#</a></h1>
<section id="discuss">
<h2>Discuss<a class="headerlink" href="#discuss" title="Permalink to this heading">#</a></h2>
<p>Please make sure that you already go through <a class="reference internal" href="general.html"><span class="doc">General Guideline</span></a>.
Again, please make sure we have consensus on the new feature request.
The best and the most transparent way is to
<a class="reference external" href="https://github.com/s3prl/s3prl/issues/new?assignees=&amp;labels=&amp;template=feature_request.md&amp;title=">submit your feature request</a>.</p>
</section>
<section id="copy-from-the-template">
<h2>Copy from the template<a class="headerlink" href="#copy-from-the-template" title="Permalink to this heading">#</a></h2>
<p>To add new upstream, you can start with an <a class="reference external" href="https://github.com/s3prl/s3prl/tree/main/s3prl/upstream/example">example</a>
Suppose your new upstream called <code class="code docutils literal notranslate"><span class="pre">my_awesome_upstream</span></code>, the simplest way to start will be the following:</p>
<ol class="arabic simple">
<li></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">S3PRL_ROOT</span><span class="si">}</span>
cp<span class="w"> </span>-r<span class="w"> </span>s3prl/upstream/example/<span class="w"> </span>s3prl/upstream/my_awesome_upstream
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>In <code class="code docutils literal notranslate"><span class="pre">s3prl/upstream/my_awesome_upstream/hubconf.py</span></code>, change <code class="code docutils literal notranslate"><span class="pre">customized_upstream</span></code> to <code class="code docutils literal notranslate"><span class="pre">my_entry_1</span></code></p></li>
<li><p>In <code class="code docutils literal notranslate"><span class="pre">s3prl/hub.py</span></code>, add <code class="code docutils literal notranslate"><span class="pre">from</span> <span class="pre">s3prl.upstream.my_awesome_upstream.hubconf</span> <span class="pre">import</span> <span class="pre">*</span></code></p></li>
<li></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>utility/extract_feat.py<span class="w"> </span>my_entry_1<span class="w"> </span>sample_hidden_states
<span class="c1"># this script extract hidden states from an upstream entry to the &quot;sample_hidden_states&quot; folder</span>
</pre></div>
</div>
<p>This will extract the hidden states from this <code class="code docutils literal notranslate"><span class="pre">my_entry_1</span></code> entry.
The default content in <code class="code docutils literal notranslate"><span class="pre">s3prl/upstream/example/</span></code> always works, so you can simply edit the files
inside the new <code class="code docutils literal notranslate"><span class="pre">s3prl/upstream/my_awesome_upstream</span></code> folder to enable your new upstream.</p>
</section>
<section id="implement">
<h2>Implement<a class="headerlink" href="#implement" title="Permalink to this heading">#</a></h2>
<p>The folder is in the following structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>my_awesome_upstream
<span class="p">|</span>
<span class="w"> </span>----<span class="w"> </span>expert.py
<span class="p">|</span>
<span class="w"> </span>----<span class="w"> </span>hubconf.py
</pre></div>
</div>
<p>In principle, <code class="code docutils literal notranslate"><span class="pre">hubconf.py</span></code> serves as the URL registry, where each callable function is an entry specifying
the source of the checkpoint, while the <code class="code docutils literal notranslate"><span class="pre">expert.py</span></code> serves as the wrapper of your model definition to fit
with our upstream API.</p>
<p>During your implementation, please try to remove as many package dependencies as possible, since the upstream
functionality is our core feature, and should have minimal dependencies to be maintainable.</p>
</section>
<section id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this heading">#</a></h2>
<p>After you implementation, please make sure all your entries can pass <a class="reference external" href="https://github.com/s3prl/s3prl/blob/8eac602117003e2bb5cdb7a4d0e94cc9975fd4f2/test/test_upstream.py#L194-L250">the tests</a>
The <code class="code docutils literal notranslate"><span class="pre">test_upstream_with_extracted</span></code> test case requires you to pre-extract the expected hidden states via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>utility/extract_feat.py<span class="w"> </span>my_awesome_upstream<span class="w"> </span>./sample_hidden_states
</pre></div>
</div>
<p>That is, the test case expects there will be a <code class="code docutils literal notranslate"><span class="pre">my_awesome_upstream.pt</span></code> in the <code class="code docutils literal notranslate"><span class="pre">sample_hidden_states</span></code> folder.</p>
<p>All the existing sampled hidden states are hosted at a <a class="reference external" href="https://huggingface.co/datasets/s3prl/sample_hidden_states/tree/main">Huggingface Dataset Repo</a>,
and we expect you to clone (by <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span></code>) this <code class="code docutils literal notranslate"><span class="pre">sample_hidden_states</span></code> repo and add the sampled hidden states for your new entries.</p>
<p>To make changes to this hidden states repo, please follow the steps <a class="reference external" href="https://huggingface.co/datasets/s3prl/sample_hidden_states/discussions">here</a>
to create a pull request, so that our core maintainer can sync the hidden states extracted by you.</p>
<p>In conclusion, to add new upstream one needs to make two pull requests:</p>
<ul class="simple">
<li><p>To <a class="reference external" href="https://github.com/s3prl/s3prl/pulls">https://github.com/s3prl/s3prl/pulls</a></p></li>
<li><p>To <a class="reference external" href="https://huggingface.co/datasets/s3prl/sample_hidden_states/tree/main">https://huggingface.co/datasets/s3prl/sample_hidden_states/tree/main</a></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In fact, due to the huge time cost, most of the upstreams in S3PRL will not be tested in Github Action CI (or else it will take several hours
to download all the checkpoints for every PRs). However, our core maintainers will still clone the repository and run tox locally to make sure
everything works fine, and there is a <a class="reference external" href="https://github.com/s3prl/s3prl/blob/8eac602117003e2bb5cdb7a4d0e94cc9975fd4f2/tox.ini#L11">tox environment</a>
testing all the upstreams.</p>
</div>
</section>
<section id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this heading">#</a></h2>
<p>After all the implementation, make sure your efforts are known by the users by adding documentation of your entries at
the <a class="reference internal" href="../tutorial/upstream_collection.html"><span class="doc">S3PRL Upstream Collection</span></a> tutorial page. Also, you can add your name at the bottom of the tutorial
page if you like.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../_autosummary/s3prl.nn.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">nn</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="general.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">General Guideline</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, S3PRL Team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Adding New Upstream</a><ul>
<li><a class="reference internal" href="#discuss">Discuss</a></li>
<li><a class="reference internal" href="#copy-from-the-template">Copy from the template</a></li>
<li><a class="reference internal" href="#implement">Implement</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/js/custom.js"></script>
    </body>
</html>